<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Juegos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="mx-5 px-5" id="main-container">
        <h1 class="text-center ">CRUD de Juegos</h1>

        <!-- Formulario para crear un nuevo juego -->
        <div class="mx-auto " id="crear-div" v-if="formCrear" @submit.prevent="crearJuego">
            <h2>Crear juego</h2>
            <form id="crear-form-juego">
                <div class="row  ">
                    <div class="col-md-6 mb-3">
                        <label for="titulo" class="form-label">Titulo:</label>
                        <input type="text" id="titulo" name="titulo" class="form-control" v-model="juegoNuevo.titulo"
                            required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="precio" class="form-label">Precio:</label>
                        <input type="number" id="precio" name="precio" class="form-control" v-model="juegoNuevo.precio"
                            required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="distribuidor" class="form-label">Distribuidor:</label>
                        <input type="text" id="distribuidor" name="distribuidor" class="form-control"
                            v-model="juegoNuevo.distribuidor" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="desarrollador" class="form-label">Desarrollador</label>
                        <input type="text" id="desarrollador" name="ram__min" class="form-control"
                            v-model="juegoNuevo.desarrollador" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="img_principal" class="form-label">URL imagen principal:</label>
                        <input type="url" id="img_principal" name="img_principal" class="form-control"
                            v-model="juegoNuevo.img_principal" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="lanzamiento" class="form-label">Lanzamiento:</label>
                        <input type="date" id="lanzamiento" name="lanzamiento" class="form-control"
                            v-model="juegoNuevo.lanzamiento" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="requisitosID" class="form-label">Requisitos ID:</label>
                        <input type="number" id="requisitosID" name="requisitosID" class="form-control"
                            v-model="juegoNuevo.requisitosID" required>
                    </div>
                    <div class="col-md-6 mb-3">

                        <label for="descripcion" class="form-label">Descripcion:</label>
                        <textarea name="descripcion" id="descripcion" class="form-control" cols="30" rows="1"
                            style="resize: none;" v-model="juegoNuevo.descripcion"></textarea>
                    </div>
                </div>
                <div>
                    <button type="submit" id="btn-crear" class="btn btn-primary me-3" value="crear-juego">Crear</button>
                    <button @click="ocultarFormCrear" class="btn btn-danger">Cancelar</button>

                </div>
            </form>
        </div>

        <!-- Formulario para editar un juego  -->
        <div class="mb-5" id="editar-div" v-if="juegoSeleccionado" @submit.prevent="actualizarJuego">
            <h2>Editar juego</h2>
            <form id="editar-form-juego">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="ID" class="form-label">ID:</label>
                        <input type="text" id="ID" name="ID" class="form-control" v-model="juegoSeleccionado.ID"
                            required readonly>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="titulo2" class="form-label">Titulo:</label>
                        <input type="text" id="titulo2" name="titulo2" class="form-control"
                            v-model="juegoSeleccionado.titulo" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="precio2" class="form-label">Precio:</label>
                        <input type="text" id="precio2" name="precio2" class="form-control"
                            v-model="juegoSeleccionado.precio" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="distribuidor2" class="form-label">Distribuidor:</label>
                        <input type="text" id="distribuidor2" name="distribuidor2" class="form-control"
                            v-model="juegoSeleccionado.distribuidor" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="desarrollador2" class="form-label">Desarrollador</label>
                        <input type="text" id="desarrollador2" name="desarrollador2" class="form-control"
                            v-model="juegoSeleccionado.desarrollador" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="img_principal2" class="form-label">URL imagen principal:</label>
                        <input type="url" id="img_principal2" name="img_principal2" class="form-control"
                            v-model="juegoSeleccionado.img_principal" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="lanzamiento2" class="form-label">Lanzamiento:</label>
                        <input type="date" id="lanzamiento2" name="lanzamiento2" class="form-control"
                            v-model="juegoSeleccionado.lanzamiento" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="requisitosID2" class="form-label">Requisitos ID:</label>
                        <input type="number" id="requisitosID2" name="requisitosID2" class="form-control"
                            v-model="juegoSeleccionado.requisitosID" required>
                    </div>
                    <div class="col-md-6 mb-3">

                        <label for="descripcion2" class="form-label">Descripcion:</label>
                        <textarea name="descripcion" id="descripcion2" class="form-control" cols="30" rows="1"
                            style="resize: none;" v-model="juegoSeleccionado.descripcion"></textarea>
                    </div>
                </div>
                <div>
                    <button type="submit" id="btn-editar" class="btn btn-primary me-3">Editar</button>
                    <button @click="cancelarEdicion()" class="btn btn-danger">Cancelar</button>
                </div>
            </form>
        </div>

        <!-- Lista de juegos -->
        <div class="" id="juegos-div" v-if="!formCrear & !juegoSeleccionado">
            <h2>Lista de juegos</h2>
            <div class="text-end ">
                <button @click="mostrarFormCrear()" class="btn btn-primary my-2 me-2">AÃ±adir</button>

            </div>
            <div class="table-responsive">
                <table class="table table-light">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Titulo</th>
                            <th>Distribuidor</th>
                            <th>Desarrollador</th>
                            <th>Lanzamiento</th>
                            <th>Descripcion</th>
                            <th>Precio</th>
                            <th>Requisitos ID</th>
                            <th>Img principal</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tbody">
                        <tr v-for="juego in juegos" :key="juego.id">
                            <td>{{ juego.ID }}</td>
                            <td>{{ juego.titulo }}</td>
                            <td>{{ juego.distribuidor }}</td>
                            <td>{{ juego.desarrollador }}</td>
                            <td>{{ juego.lanzamiento }}</td>
                            <td>{{ juego.descripcion }}</td>
                            <td>{{ juego.precio }}</td>
                            <td>{{ juego.requisitosID }}</td>
                            <td>{{ juego.img_principal}}</td>
                            <td>
                                <button @click="cargarEditarJuego(juego)"
                                    class="btn btn-primary col-md-12 mb-3">Editar</button>
                                <button @click="eliminarUsuario(usuario.id)"
                                    class="btn btn-danger col-md-12">Eliminar</button>
                            </td>

                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>



        const { createApp } = Vue
        createApp({
            data() {
                return {
                    juegos: [], juegoSeleccionado: null, formCrear: null, juegoNuevo: { titulo: '', distribuidor: '', desarrollador: '', lanzamiento: '', descripcion: '', precio: '', requisitosID: '', img_principal: '' }
                };
            },
            mounted() {
                this.obtenerListado();
            },
            methods: {

                cargarEditarJuego(juego) {
                    this.juegoSeleccionado = { ...juego }; // Copia los datos del juego seleccionado
                },
                cancelarEdicion() {
                    this.juegoSeleccionado = null
                },
                mostrarFormCrear() {
                    this.formCrear = true
                },
                ocultarFormCrear() {
                    this.formCrear = null
                },
                obtenerListado() {
                    fetch('https://lucianodavezac.pythonanywhere.com/api/juegos')
                        .then(response => response.json())
                        .then(data => {
                            this.juegos = data; // Asigna los datos obtenidos a la propiedad juegos
                        })
                        .catch(error => {
                            console.error(error);
                        });
                },
                crearJuego() {
                    {
                        fetch('https://lucianodavezac.pythonanywhere.com/api/juegos', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                titulo: this.juegoNuevo.titulo,
                                distribuidor: this.juegoNuevo.distribuidor,
                                desarrollador: this.juegoNuevo.desarrollador,
                                lanzamiento: this.juegoNuevo.lanzamiento,
                                descripcion: this.juegoNuevo.descripcion,
                                precio: this.juegoNuevo.precio,
                                requisitosID: this.juegoNuevo.requisitosID,
                                img_principal: this.juegoNuevo.img_principal
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                // LÃ³gica despuÃ©s de guardar los cambios exitosamente
                                alert('Juego guardado', data);
                                this.juegoNuevo = { titulo: '', distribuidor: '', desarrollador: '', lanzamiento: '', descripcion: '', precio: '', requisitosID: '', img_principal: '' }; // Reinicia el usuario seleccionado despuÃ©s de guardar los cambios
                                this.formCrear = null;
                                this.obtenerListado();


                            })
                            .catch(error => {
                                // LÃ³gica en caso de error al guardar los cambios
                                alert('Error al guardar los cambios:', error);
                            });
                    }
                },
                actualizarJuego() {
                    fetch('https://lucianodavezac.pythonanywhere.com/api/juegos/' + this.juegoSeleccionado.ID, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            titulo: this.juegoSeleccionado.titulo,
                            distribuidor: this.juegoSeleccionado.distribuidor,
                            desarrollador: this.juegoSeleccionado.desarrollador,
                            lanzamiento: this.juegoSeleccionado.lanzamiento,
                            descripcion: this.juegoSeleccionado.descripcion,
                            precio: this.juegoSeleccionado.precio,
                            requisitosID: this.juegoSeleccionado.requisitosID,
                            img_principal: this.juegoSeleccionado.img_principal
                        }),
                    })
                        .then(response => response.json())
                        .then(data => {
                            // LÃ³gica despuÃ©s de guardar los cambios exitosamente
                            alert('Cambio guardado', data);
                            this.juegoSeleccionado = null; // Reinicia el usuario seleccionado despuÃ©s de guardar los cambios
                            this.obtenerListado();



                        })
                        .catch(error => {
                            // LÃ³gica en caso de error al guardar los cambios
                            alert('Error al guardar los cambios:', error);
                        });
                },
            }
        }).mount('#main-container');

    </script>
</body>

</html>